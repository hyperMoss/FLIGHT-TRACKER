# 航班价格监控系统

一个自动监控携程网航班价格的 Python 程序，支持定时抓取最低价格航班信息并推送到飞书群。

## 功能特性

- 🛫 **自动抓取航班信息**: 从携程网获取指定航线的航班数据
- 💰 **价格排序**: 自动筛选并显示价格最低的三个航班
- 🤖 **飞书推送**: 将航班信息自动推送到飞书群聊
- ⏰ **定时监控**: 支持自定义时间间隔的定时抓取
- 👻 **无头模式**: 后台运行，不显示浏览器窗口
- 🛡️ **错误处理**: 完善的异常处理和错误通知机制

## 环境要求

- Python 3.7+
- Chrome/Chromium 浏览器

## 安装步骤

### 1. 克隆项目

```bash
git clone <项目地址>
cd flight-monitor
```

### 2. 创建虚拟环境

```bash
python3 -m venv venv
```

### 3. 激活虚拟环境

```bash
# Linux/Mac
source venv/bin/activate

# Windows
venv\Scripts\activate
```

### 4. 安装依赖包

```bash
pip install -r requirements.txt
```

## 配置说明

### 飞书机器人配置

1. 在飞书群中添加自定义机器人
2. 获取 Webhook 地址
3. 在 `main.py` 中修改 `FEISHU_WEBHOOK` 变量

### 航班路线配置

在 `CrawlAndDisplay()` 函数中修改以下参数：

- `departurePlace`: 出发城市代码（如：'sha' 代表上海）
- `arrivePlace`: 到达城市代码（如：'can' 代表广州）
- `departureDate`: 出发日期（格式：'2025-08-03'）

### 常用城市代码

| 城市 | 代码 | 城市 | 代码 |
| ---- | ---- | ---- | ---- |
| 上海 | sha  | 北京 | bjs  |
| 广州 | can  | 深圳 | szx  |
| 杭州 | hgh  | 成都 | ctu  |
| 西安 | xiy  | 重庆 | ckg  |

## 运行程序

### 基本运行

```bash
python main.py
```

### 自定义监控间隔

修改 `StartScheduledCrawling()` 函数的 `interval_minutes` 参数：

```python
# 每15分钟监控一次
StartScheduledCrawling(15, FEISHU_WEBHOOK)
```

## 输出示例

### 控制台输出

```
=== 最低价格航班信息 (2025-01-20 14:30:15) ===
--------------------------------------------------------------------------------
第1名 - 价格: ¥580
  航空公司: 春秋航空
  出发: 上海虹桥 07:25
  到达: 广州白云 10:15
  航班信息: 9C8589
----------------------------------------
第2名 - 价格: ¥620
  航空公司: 中国南方航空
  出发: 上海浦东 08:00
  到达: 广州白云 11:05
  航班信息: CZ3539
----------------------------------------
```

### 飞书推送消息

```
🛫 最低价格航班信息 (2025-01-20 14:30:15)
==================================================

🏆 第1名 - 价格: ¥580
✈️ 航空公司: 春秋航空
🛫 出发: 上海虹桥 07:25
🛬 到达: 广州白云 10:15
ℹ️ 航班信息: 9C8589
------------------------------
```

## 项目结构

```
flight-monitor/
├── main.py              # 主程序文件
├── requirements.txt     # 依赖包列表
├── README.md           # 项目说明文档
└── venv/               # 虚拟环境目录
```

## 核心函数说明

| 函数名                     | 功能描述               |
| -------------------------- | ---------------------- |
| `FlightsPage()`            | 抓取携程航班页面数据   |
| `GetTopThreeFlights()`     | 获取价格最低的三个航班 |
| `send_to_feishu()`         | 发送消息到飞书机器人   |
| `CrawlAndDisplay()`        | 主抓取和显示逻辑       |
| `StartScheduledCrawling()` | 启动定时监控任务       |

## 依赖包

- `beautifulsoup4`: HTML 解析
- `DrissionPage`: 浏览器自动化
- `requests`: HTTP 请求
- `schedule`: 定时任务（可选）

## 注意事项

⚠️ **重要提醒**

- 请遵守携程网站的使用条款和 robots.txt 规则
- 建议设置合理的抓取间隔，避免对服务器造成压力
- 程序仅供学习和个人使用，请勿用于商业用途

## 故障排除

### 常见问题

1. **ModuleNotFoundError**: 确保已安装所有依赖包
2. **浏览器启动失败**: 检查 Chrome 浏览器是否正确安装
3. **飞书推送失败**: 验证 Webhook 地址是否正确
4. **航班数据为空**: 检查城市代码和日期格式是否正确

### 调试模式

将 `headless=False` 可以显示浏览器窗口进行调试：

```python
soup = FlightsPage('sha', 'can', '2025-08-03', headless=False)
```

## 更新日志

- **v1.0.0**: 基础航班抓取功能
- **v1.1.0**: 添加价格排序和筛选
- **v1.2.0**: 集成飞书机器人推送
- **v1.3.0**: 添加定时监控和错误处理

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件至：[your-email@example.com]
